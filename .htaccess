# FORCE .php extensions + Custom Error Pages

# Custom Error Pages
ErrorDocument 404 /404.php
ErrorDocument 401 /unauthorized.php
ErrorDocument 403 /unauthorized.php

# Force .php extension redirects
RewriteEngine On

# Redirect clean URLs to .php files
RewriteRule ^dashboard/?$ dashboard.php [R=301,L]
RewriteRule ^admin/?$ admin.php [R=301,L]
RewriteRule ^profile/?$ profile.php [R=301,L]
RewriteRule ^logout/?$ logout.php [R=301,L]

# Ensure index.php is the default
DirectoryIndex index.php

# Prevent MultiViews from creating clean URLs
Options -MultiViews

# Force .php extension to be required
<IfModule mod_rewrite.c>
    # Don't allow access to files without extensions that match PHP files
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(dashboard|admin|profile|logout)$ $1.php [R=301,L]
</IfModule>

# Security headers + Cache control
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    
    # Force no cache for PHP files to prevent URL caching
    <FilesMatch "\.php$">
        Header always set Cache-Control "no-cache, no-store, must-revalidate"
        Header always set Pragma "no-cache"
        Header always set Expires "0"
    </FilesMatch>
</IfModule>

# Prevent access to sensitive files
<Files ~ "^\.">
    Order allow,deny
    Deny from all
</Files>

<Files ~ "\.sql$">
    Order allow,deny
    Deny from all
</Files>

# SEO - Redirect www to non-www
RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
RewriteRule ^(.*)$ https://%1/$1 [R=301,L]